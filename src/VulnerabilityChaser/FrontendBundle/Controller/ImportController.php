<?php

namespace VulnerabilityChaser\FrontendBundle\Controller;

use VulnerabilityChaser\FrontendBundle\Entity\Scans;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;

class ImportController extends Controller
{
    public function uploadAction()
    {
    	$scan = new Scans();
    	$form = $this->createFormBuilder($scan)
    	->add('name')
    	->add('file')
    	->getForm();

    	if ($this->getRequest()->getMethod() === 'POST') {
    		$form->bindRequest($this->getRequest());
    		if ($form->isValid()) {
    			$em = $this->getDoctrine()->getEntityManager();

    			$scan->upload();
    			$scan->setDate(new \DateTime());
    			
    			$em->persist($scan);
    			$em->flush();

    			$this->redirect($this->generateUrl('users'));
    		}
    	}

    	//return array('form' => $form->createView());
    	return $this->render('FrontendBundle:Import:upload.html.twig',array ('form' => $form->createView()));
    }
}
<?php

namespace VulnerabilityChaser\FrontendBundle\Controller;

use VulnerabilityChaser\FrontendBundle\Entity\Scans;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;

class DefaultController extends Controller
{
    
    public function indexAction($name)
    {
        return $this->render('FrontendBundle:Default:index.html.twig', array('name' => $name));
    }

    public function usersAction()
    {
        $em = $this->getDoctrine()->getEntityManager();
        $users = $em->getRepository('FrontendBundle:Users')->findAll();
        return $this->render('FrontendBundle:Default:users.html.twig', array('users' => $users));
    }


    public function uploadAction()
    {
    	$scan = new Scans();
    	$form = $this->createFormBuilder($scan)
    	->add('name')
    	->add('file')
    	->getForm();

    	if ($this->getRequest()->getMethod() === 'POST') {
    		$form->bindRequest($this->getRequest());
    		if ($form->isValid()) {
    			$em = $this->getDoctrine()->getEntityManager();

    			$scan->upload();
    			$scan->setDate(new \DateTime());
    			
    			$em->persist($scan);
    			$em->flush();

    			$this->redirect($this->generateUrl('users'));
    		}
    	}

    	//return array('form' => $form->createView());
    	return $this->render('FrontendBundle:Default:upload.html.twig',array ('form' => $form->createView()));
    }

    public function loginAction()
    {
    	return $this->render('FrontendBundle:Default:login.html.twig');
    	 
    }

}

<?php

namespace VulnerabilityChaser\FrontendBundle\Repository;;

use Doctrine\ORM\EntityRepository;

class VulnerabilitiesRepository extends EntityRepository {


	/**
	 * Devuelve el Ãºltimo estado asociado a la vulnerabilidad con identificador $vID
	 * @param integer $vID
	 */
	public function getLastStatus($vID)
	{
		$em = $this->getEntityManager();
			
		$query = $em->createQuery('SELECT s FROM FrontendBundle:Status s
				JOIN s.vulnerability sv
				WHERE sv.id = :vID
				Order By s.datestart ASC');	
		$query->setParameter('vID', $vID);
		
		try {
			$status = $query->getResult();
		} catch (\Doctrine\ORM\NoResultException $e) {
			return null;
		}
		return $status[0];
	}
}

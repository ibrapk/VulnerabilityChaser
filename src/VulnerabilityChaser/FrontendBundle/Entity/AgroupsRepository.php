<?php

namespace VulnerabilityChaser\FrontendBundle\Entity;

use Doctrine\ORM\EntityRepository;

class AgroupsRepository extends EntityRepository {


	/**
	 * Devuelve un array de dos dimensiones. [grupo][vulnerabilidades del grupo]
	 */
	public function getGroupVulnerabilities()
	{
		$em = $this->getEntityManager();
			
		$query = $em->createQuery('SELECT g, COUNT(gav.id) FROM FrontendBundle:Agroups g 
				JOIN g.assets ga JOIN ga.vulnerabilities gav
				GROUP BY g.id');
		
		try {
			$vPerGroup = $query->getResult();
		} catch (\Doctrine\ORM\NoResultException $e) {
			return null;
		}
		return $vPerGroup;
	}
}
